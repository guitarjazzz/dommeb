

TVimageResizer plugin v1.9.4.6 для MODx Evolution 1.0.x

Andchir - http://modx-shopkeeper.ru

----------------------------------------------

Плагин для уменьшения размеров картинок из TV-параметров (Тип ввода - Image).
При сохранении документа картинка, указанная в TV-параметре, уменьшается до нужного размера и копируется в нужную папку (указывается в конфигурации).
Также в значении TV-параметра изменяется путь на путь до уменьшенной копии картинки.

----------------------------------------------

Используется EasyPhpThumbnail class by JF Nutbroek
http://www.mywebmymail.com/?q=content/easyphpthumbnail-class

Используется Image util library 1.0.0 by Alexey Smallder
http://smallder.ru

----------------------------------------------

Установка:

1. Поместите папку tvimageresizer в папку с плагинами assets/plugins/.

2. В системе управления откройте "Элементы" -> "Управление элементами" -> "Плагины" -> "Создать плагин".

3. Название плагина:
   TVimageResizer
   
   Описание:
   Плагин для создания уменьшенных копий картинок параметров (TV - Image).
   
   Код плагина (php):
   require MODX_BASE_PATH.'assets/plugins/tvimageresizer/TVimageResizer.inc.php';
   
   Конфигурация плагина:
   &tv_ids=TV IDs;string; &dirs=Thumb folders;string;small~medium &width=Width;string;200~400 &height=Height;string;100~200 &rcorner=Corners percentage of clipping;string; &backgroundColor=Background color;string;#FFFFFF &watermark=Watermark image path (png);string; &watermarkPos=Watermark position;string;90% 90% &cprighttext=Copyright text;string; &quality=Quality;int;90 &mirror=Mirror effect;list;yes,no;no &crop=Cropping;list;yes,no,crop_resized,fill_resized;no &save_o_name=Save only name;list;yes,no;no &rename_images=Rename images;list;yes,no;no &refresh_all_images=Refresh all images;list;yes,no;no
   
   Системные события:
   OnBeforeDocFormSave, OnSiteRefresh
   
4. Создайте TV-параметр с типом ввода Image. В конфигурации плагина укажите его ID. Можно несколько через запятую.

----------------------------------------------

Конфигурация:

TV IDs - ID TV, для которых нужна возможность изменения размера через запятую.
Thumb folders - папка, в которую будет загружена копия картинки. Можно указывать несколько через разделитель "~" (без кавычек).
Width - ширина создаваемой копии картинки. Можно указывать несколько через разделитель "~".
Height - высота создаваемой копии картинки. Можно указывать несколько через разделитель "~".
Cropping - обрезать картинки (создавать точно по указанным размерам без уменьшения). crop_resized - уменьшить + обрезать; fill_resized - пропорционально уменьшить, заполнив поля цветом (Background color).
Corners percentage of clipping - скруглять углы (размер угла в процентах). Можно указывать несколько для разных картинок через разделитель "~".
Watermark image path (png) - накладывать водяной знак (путь до PNG-картинки). Можно указывать несколько для разных картинок через разделитель "~".
Copyright text - наложить текст на картинку. Можно указывать несколько для разных картинок через разделитель "~".
Save only name - сохранять в поле только имя файла картинки. Можно использовать для создания картинки со ссылкой на большое изображение; 
Quality - качество изображения (размер сжатия).
Background color - цвет фона (учитывается при скруглении углов и др.).
Rename images - переименовывать картинки. Все картинки будут переименовываться с указанием даты: d.m.y_H.i.
Mirror effect - эффект зеркального отражения.
Refresh all images - обновлять все картинки при нажатии на кнопку "Очистить кэш" (рекомендуется включать только на один раз, т.к. скорость довольно низкая).

----------------------------------------------

Для разных шаблонов можно назначить разные размеры картинок.

Пример:
TV IDs: 1
Thumb folders: small~medium
Width: 130,10|300,11~400
Height: 130,10|200,11~200

В этом случае в папке small/ будет
картинка 130x130, если шаблон ID 10,
картинка 300x200, если шаблон ID 11
в папке medium/ будет картинка 400x200 для любых шаблонов.

----------------------------------------------

Примечание:

Если нужно создать маленькую картинку со ссылкой на большую, можно использовать параметр Save only name - yes.
Пример:

<a href="assets/images/[*image*]" target="_blank"><img src="assets/images/small/[*image*]" width="100" height="100" alt="" /></a>

Другой вариант - PHx-модификатор "replace".

-----------------------------------------------

Использование PHx-модификатора "replace":

Например у нас есть две картинки
assets/images/small/image.jpg - значение TV-параметра "image"
assets/images/big/image.jpg - та же картинка но большего размера

Первую картинку можно вывести так:
[*image*]
А вторую через модификатор "replace" так:
[*image:replace=`small,big`*]

Нужно установить плагин PHx и скопировать файл install/replace.phx.php в папку assets/plugins/phx/modifiers/.

-----------------------------------------------

Что нового в 1.9.4:

1. Сделано обновление всех картинок при нажатии на кнопку "Очистить кэш" (рекомендуется включать только на один раз, т.к. скорость довольно низкая).

2. Исправлена некорректная работа с наложением водяного знака 24-битного PNG.

3. Добавлен параметр "Cropping: fill_resized" - пропорционально уменьшить, заполнив поля цветом (Background color).

4. Добавлен эффект зеркального отражения (Mirror effect).

5. Исправлены мелкие и не очень ошибки.

